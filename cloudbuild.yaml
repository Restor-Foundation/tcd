steps:

  - id: Make checkpoint folder
    name: "ubuntu"
    args: ["mkdir", "/workspace/checkpoints"]

  - id: Copy instance segmentation model files
    name:  gcr.io/google.com/cloudsdktool/cloud-sdk
    entrypoint: gsutil
    args: ["cp", "gs://restor-deep-learning/models/segmentation/instance/tcd_maskrcnn_r50.pth", "/workspace/checkpoints/model_final.pth"]

  - id: Copy semantic segmentation model files
    name: gcr.io/google.com/cloudsdktool/cloud-sdk
    entrypoint: gsutil
    args: ["cp", "gs://restor-deep-learning/models/segmentation/semantic/tcd_unet_resnet34.ckpt", "/workspace/checkpoints/unet_resnet34.ckpt"]

  - id: Clone repo again for container inclusion
    name: gcr.io/cloud-builders/git
    dir: '/workspace/docker'
    args: ['clone', 'https://github.com/Restor-Foundation/tcd-pipeline']
    
  - id: Build image
    name: 'gcr.io/cloud-builders/docker'
    dir: '/workspace/docker'
    args: ['build', '-t', 'tcd-pipeline', -f, 'Dockerfile']
