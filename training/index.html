
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../prediction/">
      
      
        <link rel="next" href="../cache/">
      
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Training - Restor Tree Crown Delineation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#training-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Restor Tree Crown Delineation" class="md-header__button md-logo" aria-label="Restor Tree Crown Delineation" data-md-component="logo">
      
  <img src="../images/restor_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Restor Tree Crown Delineation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Training
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Restor Tree Crown Delineation" class="md-nav__button md-logo" aria-label="Restor Tree Crown Delineation" data-md-component="logo">
      
  <img src="../images/restor_logo.png" alt="logo">

    </a>
    Restor Tree Crown Delineation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCD Pipeline Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../prediction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Predicting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Training
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    <span class="md-ellipsis">
      Quickstart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset notes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expected-format" class="md-nav__link">
    <span class="md-ellipsis">
      Expected format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-ms-coco-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Generating MS-COCO datasets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Training parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instance-segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Instance Segmentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#semantic-segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Semantic Segmentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resuming-training" class="md-nav__link">
    <span class="md-ellipsis">
      Resuming training
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resuming training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-training-curves" class="md-nav__link">
    <span class="md-ellipsis">
      Typical training curves
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#independent-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Independent evaluation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exporting-models-for-production-use" class="md-nav__link">
    <span class="md-ellipsis">
      Exporting models for production use
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmarks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Results caching
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OAM-TCD dataset
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model card
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benchmarking
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../citing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Citation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../acknowledgements.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgements
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipeline architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1" >
        
          
          <label class="md-nav__link" for="__nav_13_1" id="__nav_13_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    tcd_pipeline
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1">
            <span class="md-nav__icon md-icon"></span>
            tcd_pipeline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1_2" >
        
          
          <label class="md-nav__link" for="__nav_13_1_2" id="__nav_13_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    cache
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1_2">
            <span class="md-nav__icon md-icon"></span>
            cache
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/cache/cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/cache/instance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/cache/semantic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semantic
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1_3" >
        
          
          <label class="md-nav__link" for="__nav_13_1_3" id="__nav_13_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1_3">
            <span class="md-nav__icon md-icon"></span>
            data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/data/cocodataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cocodataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/data/datamodule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    datamodule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/data/imagedataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    imagedataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/data/tiling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tiling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1_4" >
        
          
          <label class="md-nav__link" for="__nav_13_1_4" id="__nav_13_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1_4">
            <span class="md-nav__icon md-icon"></span>
            models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/instance_segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    instance_segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/segformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/segformermodule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segformermodule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/segmentationmodule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentationmodule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/semantic_segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semantic_segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/smp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/smpmodule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    smpmodule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/train_instance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    train_instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/models/train_semantic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    train_semantic
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1_6" >
        
          
          <label class="md-nav__link" for="__nav_13_1_6" id="__nav_13_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    postprocess
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1_6">
            <span class="md-nav__icon md-icon"></span>
            postprocess
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/postprocess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/postprocess/instanceprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    instanceprocessor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/postprocess/postprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postprocessor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/postprocess/processedinstance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    processedinstance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/postprocess/semanticprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semanticprocessor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/report/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    report
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1_8" >
        
          
          <label class="md-nav__link" for="__nav_13_1_8" id="__nav_13_1_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    result
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1_8">
            <span class="md-nav__icon md-icon"></span>
            result
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/result/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/result/instancesegmentationresult/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    instancesegmentationresult
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/result/processedresult/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    processedresult
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/result/semanticsegmentationresult/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semanticsegmentationresult
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1_9" >
        
          
          <label class="md-nav__link" for="__nav_13_1_9" id="__nav_13_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    scripts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1_9">
            <span class="md-nav__icon md-icon"></span>
            scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/_instance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    _instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/extract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    extract
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/merge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    merge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/predict/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    predict
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/reproject/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reproject
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/scripts/train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    train
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/tcd_pipeline/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    util
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    <span class="md-ellipsis">
      Quickstart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset notes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expected-format" class="md-nav__link">
    <span class="md-ellipsis">
      Expected format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-ms-coco-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Generating MS-COCO datasets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Training parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instance-segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Instance Segmentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#semantic-segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Semantic Segmentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resuming-training" class="md-nav__link">
    <span class="md-ellipsis">
      Resuming training
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resuming training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-training-curves" class="md-nav__link">
    <span class="md-ellipsis">
      Typical training curves
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#independent-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Independent evaluation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exporting-models-for-production-use" class="md-nav__link">
    <span class="md-ellipsis">
      Exporting models for production use
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmarks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="training-models">Training models</h1>
<h2 id="quickstart">Quickstart</h2>
<p>Models are trained using a variation of the following command:</p>
<div class="highlight"><pre><span></span><code>tcd-train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>semantic<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">model</span><span class="o">=</span>unet_resnet50<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.root<span class="o">=</span>/mnt/data/tcd/folds/holdout<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.output<span class="o">=</span>/mnt/data/tcd/unet_r50/holdout
</code></pre></div>
<p>There are a couple of things that must be configured:</p>
<ol>
<li>The type of model that is being trained, here UNet with a resnet50 backbone (as well as the task type)</li>
<li>The root folder that contains the dataset we're training on (with some standard/expected paths)</li>
<li>Where the results should be stored</li>
</ol>
<p>Otherwise there are lots of things that can be customised by providing extra config key/value pairs, or by creating a new config file, but this is the basic command that we use for training all the models in the zoo.</p>
<p>For example, train a <code>segformer-mit-b5</code> model on a validation fold, with a learning rate of <code>1e-4</code>, batch size <code>1</code> and a tile size of <code>1024</code>:</p>
<div class="highlight"><pre><span></span><code>tcd-train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>semantic<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">model</span><span class="o">=</span>segformer-mit-b5<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>model.config.learning_rate<span class="o">=</span>1e-4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>model.batch_size<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.output<span class="o">=</span>output/semantic/segformer-mit-b5/kfold4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.root<span class="o">=</span>/mnt/data/tcd/kfold_4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.tile_size<span class="o">=</span><span class="m">1024</span>
</code></pre></div>
<p>or a standard Mask-RCNN model on the holdout set:</p>
<div class="highlight"><pre><span></span><code>tcd-train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>instance<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>model.config<span class="o">=</span>detectron2/detectron_mask_rcnn.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.root<span class="o">=</span>/mnt/data/tcd/holdout<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data.output<span class="o">=</span>/mnt/data/tcd/maskrcnn/holdout
</code></pre></div>
<h2 id="dataset-notes">Dataset notes</h2>
<p>Our dataset is provided in two formats: direct download as MS-COCO format from <a href="LINK TBD">Zenodo</a> and as a HuggingFace <a href="https://huggingface.co/datasets/restor/tcd">dataset</a>. For training in the pipeline, we use MS-COCO format for compatibility (and easy integration with other libraries), but the HF dataset is provided for future work and we intend to integrate it soon.</p>
<p>We provide images as 2048x2048 GeoTIFF tiles. Each tile comes from an image downloaded from Open Aerial Map, resampled to 0.1 m/px. Images are annotated with instance labels in two classes: "tree" and "canopy" where "tree" represents an individual tree and canopy represents a group.</p>
<p>Since the dataset is not particularly large, although it is larger than many open tree detection datasets, we followed a k-fold cross-validation approach for model experimentation followed by testing on a holdout dataset. We stratify the dataset into 5 folds at the source image level (e.g. one "sample" in this stratification may map to multiple tiles) with an approximately equal distribution of biomes in each fold. Thus we can get a good idea of the consistency of the annotations. Our "release" models were trained on all data except the holdout split.</p>
<h2 id="expected-format">Expected format</h2>
<p>The training scripts expect you to pass a path to a folder with the following structure</p>
<div class="highlight"><pre><span></span><code>/path/to/data
├──<span class="w"> </span>images
├──<span class="w"> </span>masks
├──<span class="w"> </span>test.json
├──<span class="w"> </span>train.json
└──<span class="w"> </span>val.json
</code></pre></div>
<p>where <code>images</code> contains images referenced in the annotation JSON files and <code>masks</code> contains identical filenames to <code>images</code>, but with <code>png</code> extensions.</p>
<h2 id="generating-ms-coco-datasets">Generating MS-COCO datasets</h2>
<p>We provide a convenience script in <code>tools/generate_dataset.py</code> to create the training dataset with the required folder structure. This script pulls the specified dataset from HuggingFace, typically <code>restor/tcd</code> and converts the Parquet records into an MS-COCO format dataset.</p>
<div class="highlight"><pre><span></span><code>usage:<span class="w"> </span>generate_dataset.py<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--tiffs<span class="o">]</span><span class="w"> </span><span class="o">[</span>--folds<span class="o">]</span><span class="w"> </span>dataset<span class="w"> </span><span class="o">[</span>dataset<span class="w"> </span>...<span class="o">]</span><span class="w"> </span>output

Convert<span class="w"> </span>a<span class="w"> </span>Restor<span class="w"> </span>TCD<span class="w"> </span>dataset<span class="w"> </span>on<span class="w"> </span>HuggingFace<span class="w"> </span>to<span class="w"> </span>MS-COCO<span class="w"> </span>format.

positional<span class="w"> </span>arguments:
<span class="w">  </span>dataset<span class="w">     </span>List<span class="w"> </span>of<span class="w"> </span>dataset<span class="w"> </span>names,<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>downloaded<span class="w"> </span>from<span class="w"> </span>HF<span class="w"> </span>Hub
<span class="w">  </span>output<span class="w">      </span>Output<span class="w"> </span>path<span class="w"> </span>where<span class="w"> </span>the<span class="w"> </span>dataset<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>created

options:
<span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">  </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">  </span>--tiffs<span class="w">     </span>Output<span class="w"> </span>images<span class="w"> </span>as<span class="w"> </span>GeoTIFF<span class="w"> </span>instead<span class="w"> </span>of<span class="w"> </span>JPEG<span class="w"> </span><span class="o">(</span>may<span class="w"> </span>slow<span class="w"> </span>down<span class="w"> </span>dataloading<span class="o">)</span>
<span class="w">  </span>--folds<span class="w">     </span>Generate<span class="w"> </span>cross-validation<span class="w"> </span>folds<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>indices<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>dataset
</code></pre></div>
<p>By default the converter will generate JPEG images as these can be much faster to load during training than tiffs. However all the information is present in the HuggingFace dataset to create GeoTIFF files, which you can create if you use the <code>--tiffs</code> option. This may be helpful if you want to do some geospatial analysis on the dataset.</p>
<p>If you pass the <code>--folds</code> option, the script will generate cross-validation folds for the dataset. We use this approach to better estimate the performance of the dataset given the limited number of images. Note that if you do decide to choose your own validation approach, you <strong>must</strong> ensure that you split based on the <code>oam_id</code> field to make sure that you don't have tiles from the same image in different folds (this will skew your results). For example, suppose you wanted to use a standard 80/20 train/val split:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;restor/tcd&#39;</span><span class="p">)</span>

<span class="c1"># Get unique IDs in the dataset</span>
<span class="n">ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;oam_id&#39;</span><span class="p">]))</span>

<span class="c1"># Split the IDs</span>
<span class="n">train_ids</span><span class="p">,</span> <span class="n">val_ids</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Generate the train and validation subsets</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;oam_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">train_ids</span><span class="p">)</span>
<span class="n">val_ds</span> <span class="o">=</span>  <span class="n">dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;oam_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">val_ids</span><span class="p">)</span>

<span class="c1"># Save datasets + train ...</span>
</code></pre></div>
<p>This is essentially the approach we used to split the dataset into folds, except we use the biome indices for stratification, for example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>

<span class="c1"># Make a mapping between OAM IDs and biomes</span>
<span class="n">id2biome</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select_columns</span><span class="p">([</span><span class="s1">&#39;oam_id&#39;</span><span class="p">,</span> <span class="s1">&#39;biome&#39;</span><span class="p">]):</span>
    <span class="n">id2biome</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;oam_id&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;biome&#39;</span><span class="p">]</span>

<span class="n">biomes</span> <span class="o">=</span> <span class="p">[</span><span class="n">id2biome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>

<span class="n">splitter</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">train_folds</span><span class="p">,</span> <span class="n">val_folds</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">biomes</span><span class="p">)</span> <span class="c1"># Returns a list of ID lists, one for each fold</span>
</code></pre></div>
<p>When you train models on the data, just pass the option <code>data.root=/path/to/output</code>. Note that the training scripts consider <code>train.json</code> and <code>val.json</code> and ignore <code>test.json</code>. The idea in cross-validation with a holdout set is that we <em>don't look</em> at the holdout data until we've decided that we've finished tuning on the validation folds.</p>
<p>For the holdout set, we periodically evaluate on the <code>test.json</code> file during training so we can take the best checkpoint (since we still need some independent measure of performance as we train). This sounds like bad practice, but this assumes we've already completed our cross-validation. In principle we only train on the full dataset a single time per model.</p>
<h2 id="training-parameters">Training parameters</h2>
<p>Training is performed with a fixed random seed (<code>42</code>) which should lead to more-or-less deterministic results. There is some randomness which is quite hard to get rid of, but you should find that if you run the training scripts on your own machine you get similar performance. The following hyperparameters were used:</p>
<ul>
<li>Seed: <code>42</code> for repeatability</li>
<li>Folds/split: as described above, we provide train/val JSON files for each split as well as a test (holdout) JSON for final evaluation</li>
<li>Learning rate: adjusted via basic grid search for performance and then fixed (this is slightly different for each model)</li>
<li>Learning rate schedule: simple stepped approach with "decrease on plateau"; this is an approach that the Detectron team has used in almost all their models and it seems to work fine.</li>
<li>Pre-training: we found that using models pre-trained on MS-COCO converged faster, though the training curves suggest that from-scratch would also work if left long enough.</li>
<li>Image size: we train on 1024 px (i.e. a random fixed-size crop from an augmented image). Model resize stages are disabled to ensure we train on the desired spatial scale.</li>
<li>Batch size: adjusted for available GPU RAM. For semantic segmentation models we use gradient accumulation for an effective batch size of 32</li>
<li>Epochs: when performing cross-validation we trained for 75 epochs to ensure convergence. We noted that convergence was achieved within 50 epochs, so we trained the release models with this reduced schedule unless the training curves suggested we should push for longer.</li>
<li>Augmentation: we augment images in a variety of ways (flipping, rotation, brightness adjustments, etc)</li>
<li>Quantisation: we trained all our models in FP32</li>
<li>Loss: for Detectron2 we use the built-in Mask-RCNN loss. For segmentation with SMP models we use focal loss, for SegFormer we use the built-in loss; in both cases we track a number of statistics during training including IoU/Jaccard Index, Accuracy and Precision, Recall and F1.</li>
</ul>
<p>For exact specifications you can check the configuration files provided with each checkpoint. Due to library improvements some parameters may have been moved or renamed since training, but we try to provide up-to-date training configs for all model variants.</p>
<p>We did not spend a huge amount of time performing hyper-parameter tuning beyond simple things like learning rate and we encourage the community to experiment. Given the sheer variety of models available, we chose architectures that we found to be simple to train and provided good performance. SegFormer, in particular, proved to be an excellent segmentation architecture with relatively few parameters compared to older baselines like UNet. We found that training transformer-based instance segmentation models was more challenging and the training to be more brittle than with CNN-based architectures. Mask-RCNN appears to perform well within the limitations of the dataset and its annotations, but there is probably some value in exploring other architectures like PointRend or Mask2Former.</p>
<h2 id="instance-segmentation">Instance Segmentation</h2>
<p>Training code for instance segmentation is provided for Mask-RCNN. While there are numerous instance detection architectures, Mask-RCNN is well-studied and Detectron2 has proved to be a reliable and robust training framework without needing lots of hyperparameter turning. Newer transformer-based architectures show promise, but we have struggled to get models to train reliably and efficiently. The dataset on HuggingFace is broadly compatible with the models in the <code>transformers</code> library, particularly with regard to mask formats.</p>
<h2 id="semantic-segmentation">Semantic Segmentation</h2>
<p>We provide training code for UNet and Segformer models. UNet is a classic architecture that is well understood, has no licesning issues, and - in our case - performs well. Segformer is a newer transformer-based architecture. It has a stricter license than UNet as provided by Nvidia, though users can apply (to NVIDIA) to use it for commercial purposes. Thus we recommend that you only use the segformer models for personal and research use.</p>
<h2 id="resuming-training">Resuming training</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Model training resumption is supported for instance segmentation models only, currently. There is a known bug with state-loading with Pytorch Lightning which causes losses to spike after resuming training - we're looking into this and will push a fix when we determine what the problem is. For now, if a segmentation training jobs fails it needs to be started from scratch.</p>
</div>
<p>To resume training, pass <code>model.resume=1</code> to the training script and set the output directory to the folder that stored the last checkpoint. Note that if you want to override something like the number of iterations (e.g. to continue training), you need to edit the config file that is stored in the output folder (all the hyperparamters will be reloaded from that file with the assumption that you just want to resume a run that crashed for some reason). Double check in the logs that the model training restarts from the expected iteration.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>tcd-train<span class="w"> </span>instance<span class="w"> </span>model.config<span class="o">=</span>detectron2/detectron_mask_rcnn.yaml<span class="w"> </span>model.resume<span class="o">=</span><span class="m">1</span><span class="w"> </span>data.root<span class="o">=</span>/home/josh/data/tcd/kfold_4<span class="w"> </span>data.output<span class="o">=</span>/mnt/internal/data/tcd/maskrcnn_r50/kfold_4/20240101_0101/
</code></pre></div>
<h3 id="typical-training-curves">Typical training curves</h3>
<p>You can see training metrics on the HuggingFace pages for each model.</p>
<p>In most cases the training loss is correlated with the parameter count of the model (e.g. b5 is better than b0). For validation, the results are a bit less clear and suggest that we are running into the limits of the annotations in the dataset. Larger models perform better, but not by a huge amount; for larger jobs where throughput/latency is important you may be fine running the smallest models. This is also the case in environments where we expect the model to perform very well, like urban canopy coverage.</p>
<h2 id="evaluation">Evaluation</h2>
<p>Model evaluation is straightforward if you use the <code>pipeline</code> method, for example here we take a "best" model from a training run and evaluate it on one of the validation data folds:</p>
<div class="highlight"><pre><span></span><code><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">,</span>
                  <span class="n">options</span><span class="o">=</span><span class="s2">&quot;model.weights=/home/josh/data/data/tcd/maskrcnn_r50/kfold_4/20240402_0806/model_best.pth&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">annotation_file</span><span class="o">=</span><span class="s2">&quot;/home/josh/data/tcd/kfold_4/val.json&quot;</span><span class="p">,</span>
    <span class="n">image_folder</span><span class="o">=</span><span class="s2">&quot;/home/josh/data/tcd/kfold_4/images&quot;</span><span class="p">,</span>
    <span class="n">output_folder</span><span class="o">=</span><span class="s2">&quot;/home/josh/data/.cache/kfold4&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>In general it's important that you run evaluation separately after training, especially if reporting results for publication. By default, Detectron2 will evaluate on the <em>final</em> model checkpoint, not the <em>best</em>. The approach above will make sure that you run on the weights that you intend to. If you have predictions already, then you can provide <code>prediction_file</code> which should be a path to a MS-COCO formatted JSON file. This will run COCO evaluation on its own, using Detectron's modified evaluator that supports an arbitrary number of detections per image.</p>
<p>For semantic segmentation, the pipeline uses the Pytorch Lightning datamodule system and whatever you've specified as the "test" split (i.e. the <code>test.json</code> file in your data directory), minimally the following should work - you can customise your pipeline as you would for normal predictions (e.g. specify options).</p>
<div class="highlight"><pre><span></span><code><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="s1">&#39;semantic&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data.root=/home/josh/data/tcd/holdout&#39;</span><span class="p">])</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</code></pre></div>
<h3 id="independent-evaluation">Independent evaluation</h3>
<p>We provide an evaluation script (<code>evaluate.py</code>) that you can use for evaluating against your own data for the following scenarios:</p>
<ul>
<li>Segmentation vs Ground truth: typically used for comparing model outputs to Canopy Height Models. The script handles differences in source resolution.</li>
<li>Instance vs instance: simplest method is to convert your ground truth to MS-COCO format and then evaluate as above. This will work even if you have a single image.</li>
<li>Instance vs keypoint: performs a point-in-polygon test for each keypoint and reports statistics on the results. This sort of evaluation can be used if you have tree crown centres, but not masks. Often the keypoints will be a subset of all the trees in the image, so some metrics like false positives can be ignored if this is the case. This is the approach we use for evaluating the Zurich and WeRobotics/Tonga datasets. The inputs are typically a shapefile with instance polygons and a list of (x,y) points.</li>
</ul>
<p>We plan to provide the following options in the future:</p>
<ul>
<li>Instance vs bounding box: you can also do this with the <code>evaluate</code> method, but you need to change the task type to <code>box</code> instead of <code>segm</code>. This will treat model predictions as boxes and ignore the masks.</li>
<li>Semantic vs keypoint: a somewhat tenuous evaluation metric, but similar to the instance approach - checks whether classified keypoints align with the predicted semantic mask. You can optionally set a radius around each keypoint that will be used to confirm.</li>
<li>Semantic vs geometry (polygon): similar to the above, computes statistics for each geometry to determine whether the prediction is correct. Bounding boxes are not great here, because they will typically contain background pixels.</li>
</ul>
<h2 id="exporting-models-for-production-use">Exporting models for production use</h2>
<p>TBD</p>
<h2 id="benchmarks">Benchmarks</h2>
<p>Our dataset is relatively unique in the literature in that we provide instance-level masks. Most other datasets either provide tree locations (i.e. single points) or bounding boxes (DeepForest). This makes an independent apples-to-apples evaluation difficult. Cross-validation statistics on our own dataset (see the paper) show that our models perform well and that our labels are probably self-consistent, and we have verified this using partner data.</p>
<p>We provide a few independent benchmarks:</p>
<ul>
<li>Detecting tree instances and canopy cover in the city of Zurich using public 10 cm SwissTopo data. The city provides both a high resolution CHM and tree locations for 20k municipal trees.</li>
<li>Predictions on a large orthomosaic from Tonga with numerous individual trees annotated.</li>
</ul>
<p>However we believe that the models speak for themselves - you are encouraged to provide your own imagery to try out. We welcome criticism and feedback if you find that the models aren't predicting as well as you expect. If you have labelled imagery, we also encourage you to share it so that we can improve the model.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.tabs.link"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../assets/external/unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>